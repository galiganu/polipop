/*!
 * Polipop v1.0.0
 *  
 * A dependency-free JavaScript library for creating discreet pop-up notifications.
 * 
 * Copyright (c) 2021 Yannis Maragos.
 * 
 * Dual-licensed under the GNU General Public License (GPL) version 3 or later
 * and the Polipop Commercial License.
 *  
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *  
 *  This file is distributed in the hope that it will be useful, but  
 *  WITHOUT ANY WARRANTY; without even the implied warranty of  
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  
 *  General Public License for more details.  
 *  
 *  You should have received a copy of the GNU General Public License  
 *  along with this program. If not, see https://www.gnu.org/licenses/.
 * 
 *  See the Polipop Commercial License at https://www.minitek.gr/licenses/polipop.
 */
 
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Polipop=t():e.Polipop=t()}(this,(function(){return(()=>{"use strict";var e={d:(t,o)=>{for(var i in o)e.o(o,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:o[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>d});const o={appendTo:"body",block:"polipop",position:"top-right",layout:"popups",theme:"default",insert:"after",spacing:10,pool:0,sticky:!1,life:3e3,pauseOnHover:!0,headerText:"Messages",closer:!0,closeText:"Close",loadMoreText:"Load more",hideEmpty:!1,interval:250,effect:"fade",easing:"linear",effectDuration:250,ready:function(){},add:function(){},beforeOpen:function(){},open:function(){},afterOpen:function(){},beforeClose:function(){},close:function(){},click:function(){}};function i(e,t,o){let i=e,s=t,n=o;"string"==typeof e&&(n=t,s=e,i=window),n=n||{},i.dispatchEvent(new CustomEvent(s,{detail:n,bubbles:!0,cancelable:!0}))}function s(){if(!this._closer)return;let e=!1;this.options.pool&&(e=this.elements&&this.elements.length===this.options.pool&&this.queue.length>0);e||this._overflow?(this._closer.querySelector("."+this._class["block__closer-text"]).innerHTML=this.options.loadMoreText,this._closer.querySelector("."+this._class["block__closer-count"]).style.display="inline-block",this._closer.querySelector("."+this._class["block__closer-count"]).textContent=this.queue.length):0===this.queue.length&&(this._closer.querySelector("."+this._class["block__closer-count"]).style.display="none",this._closer.querySelector("."+this._class["block__closer-text"]).innerHTML=this.options.closeText)}function n(){const e=this;e._wrapper&&(clearTimeout(e._resizing),e._resizing=setTimeout((function(){e._overflow=!1,c.call(e)}),500))}function l(e,t){const o=this;let i;const s="in"===t?"0":"1",n="in"===t?"1":"0";if("fade"===o.options.effect)i=[{opacity:s},{opacity:n}];else if("slide"===o.options.effect){const e="in"===t?"-110%":"0",l="in"===t?"0":"-110%",p="top-right"===o.options.position||"bottom-right"===o.options.position||"center"===o.options.position||"inline"===o.options.position,c="top-left"===o.options.position||"bottom-left"===o.options.position;p?i=[{right:e,opacity:s},{right:l,opacity:n}]:c&&(i=[{left:e,opacity:s},{left:l,opacity:n}])}return e.animate(i,{duration:o.options.effectDuration,easing:o.options.easing,iterations:1,fill:"forwards"})}function p(e){const t=this,o=document.createElement("div");o.classList.add(t._class.block__notification),e.type&&o.classList.add(t._class.block__notification_type_+e.type);const n=document.createElement("button");if(n.classList.add(t._class["block__notification-close"]),n.innerHTML="&times;",o.appendChild(n),n.addEventListener("click",(()=>{i(o,"Polipop.beforeClose")})),e.title){const i=document.createElement("div");i.classList.add(t._class["block__notification-title"]),i.innerHTML=e.title,o.appendChild(i)}if(e.content){const i=document.createElement("div");i.classList.add(t._class["block__notification-content"]),i.innerHTML=e.content,o.appendChild(i)}["beforeOpen","open","afterOpen","beforeClose","close","click"].forEach((o=>{e[o]||(e[o]=t.options[o])})),o.addEventListener("Polipop.beforeOpen",(()=>{!1!==e.beforeOpen.apply(t,[e,o])&&i(o,"Polipop.open")})),o.addEventListener("Polipop.open",(()=>{if("after"===t.options.insert?t._container.appendChild(o):"before"===t.options.insert&&t._container.insertBefore(o,t._container.querySelectorAll("."+t._class.block__notification)[0]),o.style.display="block",t.wrapperHeight+="popups"===t.options.layout?o.offsetHeight+t.options.spacing:o.offsetHeight,t.options.pool&&t.elements.length>0&&"inline"!==t.options.position){if(t.wrapperHeight+t._wrapperDistance>t._viewportHeight)return t._overflow=!0,t.wrapperHeight-="popups"===t.options.layout?o.offsetHeight+t.options.spacing:o.offsetHeight,t.queue.push(e),o.remove(),void s.call(t)}t.elements=t._container.querySelectorAll("."+t._class.block__notification),"panel"===t.options.layout&&(t._wrapper.querySelector("."+t._class["block__header-minimize"]).style.display="block",t._wrapper.classList.add(t._class.block_open)),t._wrapper.style.height=t.wrapperHeight+"px",r.call(t,o),e.open.apply(t,[e,o]);l.apply(t,[o,"in"]).finished.then((function(){o.created=new Date,o.timeLeft=!1,o.sticky=void 0!==e.sticky?e.sticky:t.options.sticky,s.call(t),c.call(t),i(o,"Polipop.afterOpen")}))})),o.addEventListener("Polipop.afterOpen",(()=>{e.afterOpen.apply(t,[e,o])})),o.addEventListener("Polipop.beforeClose",(()=>{o.removing||!1!==e.beforeClose.apply(t,[e,o])&&i(o,"Polipop.close")})),o.addEventListener("Polipop.close",(()=>{o.removing=!0,t.wrapperHeight-="popups"===t.options.layout?o.offsetHeight+t.options.spacing:o.offsetHeight;l.apply(t,[o,"out"]).finished.then((function(){if(a.apply(t,[o,"remove"]),t._wrapper.style.height=t.wrapperHeight+"px",!1!==e.close.apply(t,[e,o])&&o.remove(),t._overflow=!1,s.call(t),t.elements=t._container.querySelectorAll("."+t._class.block__notification),"panel"===t.options.layout){const e=t._wrapper.querySelector("."+t._class["block__header-count"]);let o=e.textContent;e.textContent=--o}c.call(t)}))})),o.addEventListener("click",(i=>{e.click.apply(t,[i,e,o])})),i(o,"Polipop.beforeOpen")}function c(){if(this._viewportHeight=window.innerHeight||document.documentElement.clientHeight,"inline"===this.options.position||1===this.elements.length)return;if(this.wrapperHeight+this._wrapperDistance>=this._viewportHeight){i("after"===this.options.insert?this._container.querySelectorAll("."+this._class.block__notification)[0]:this._container.querySelectorAll("."+this._class.block__notification+":last-child")[0],"Polipop.beforeClose")}}function r(e){const t="top-right"===this.options.position||"top-left"===this.options.position||"center"===this.options.position||"inline"===this.options.position,o="bottom-right"===this.options.position||"bottom-left"===this.options.position;if(t)if("after"===this.options.insert)if(this.elements.length>1){const t=this.elements[this.elements.length-2],o=parseInt(t.style.top,10)+t.offsetHeight;e.style.top=("popups"===this.options.layout?o+this.options.spacing:o)+"px"}else e.style.top=this._closerHeight+"px";else"before"===this.options.insert&&(e.style.top=this._closerHeight+"px",a.apply(this,[e,"add"]));else if(o)if("after"===this.options.insert)e.style.bottom=this._closerHeight+"px",a.apply(this,[e,"add"]);else if("before"===this.options.insert)if(this.elements.length>1){const t=this.elements[1],o=parseInt(t.style.bottom,10)+t.offsetHeight;e.style.bottom=("popups"===this.options.layout?o+this.options.spacing:o)+"px"}else e.style.bottom=this._closerHeight+"px"}function a(e,t){const o=this,i=Array.prototype.indexOf.call(o.elements,e),s="top-right"===o.options.position||"top-left"===o.options.position||"center"===o.options.position||"inline"===o.options.position,n="bottom-right"===o.options.position||"bottom-left"===o.options.position;s?"remove"===t?o.elements.forEach(((t,s)=>{if(s<=i)return;const n=parseInt(t.style.top,10)-("popups"===o.options.layout?e.offsetHeight+o.options.spacing:e.offsetHeight);t.style.top=n+"px"})):"add"===t&&"before"===o.options.insert&&o.elements.forEach(((t,i)=>{if(0===i)return;const s=parseInt(t.style.top,10)+("popups"===o.options.layout?e.offsetHeight+o.options.spacing:e.offsetHeight);t.style.top=s+"px"})):n&&("remove"===t?o.elements.forEach(((t,s)=>{if(s>i)return;const n=parseInt(t.style.bottom,10)-("popups"===o.options.layout?e.offsetHeight+o.options.spacing:e.offsetHeight);t.style.bottom=n+"px"})):"add"===t&&"after"===o.options.insert&&o.elements.forEach(((t,i)=>{if(i===o.elements.length-1)return;const s=parseInt(t.style.bottom,10)+("popups"===o.options.layout?e.offsetHeight+o.options.spacing:e.offsetHeight);t.style.bottom=s+"px"})))}function _(){const e=this;if(e._pause)return;e.elements||(e.elements=e._container.querySelectorAll("."+e._class.block__notification)),e.elements.forEach((t=>{if(!t.hasChildNodes())return;const o=void 0===e._pauseOnHover||!e._pauseOnHover;if(!1===t.timeLeft||0===t.timeLeft){const s=void 0!==t.created&&(new Date).getTime()-t.created.getTime()>parseInt(e.options.life,10),n=void 0===t.sticky||!t.sticky;s&&n&&o&&i(t,"Polipop.beforeClose")}else if(t.timeLeft>0&&o){const o=parseInt(e.options.life,10)-t.timeLeft;t.created=new Date(Date.now()-o),t.timeLeft=!1}}));const t=!1!==e.options.closer&&e._closer&&"none"===e._closer.style.display;if(e.elements.length>0&&t)e._closer.open=!0,e._closer.style.display="block",e.wrapperHeight+=e._closerHeight,e._wrapper.style.height=e.wrapperHeight+"px",l.apply(e,[e._closer,"in"]);else if(0===e.elements.length&&0===e.queue.length&&e._closer&&e._closer.open){e._closer.open=!1;l.apply(e,[e._closer,"out"]).finished.then((function(){e.wrapperHeight-=e._closerHeight,e._wrapper.style.height=e.wrapperHeight+"px",e._closer.style.display="none","panel"===e.options.layout&&(e._wrapper.querySelector("."+e._class["block__header-minimize"]).style.display="none",e.options.hideEmpty&&(e._wrapper.style.height="0px"))}))}if(e._overflow&&e.elements.length>1&&"inline"!==e.options.position||0===e.queue.length)return;(0===e.options.pool||e.elements.length<e.options.pool)&&p.call(e,e.queue.shift())}function h(){const e=this;if(e._selector=e._selector.replace(/\s/g,""),e._wrapper=document.querySelector(e._selector),e._wrapper&&e._wrapper.classList.contains(e._class.block))console.log('Error: Selector with id "'+e.options.selector+'" is used by another instance of Polipop. Initialization aborted.');else{if(e._wrapper||(e._wrapper=document.createElement("div"),e._wrapper.id=e._selector,document.querySelector(e.options.appendTo).appendChild(e._wrapper)),e._wrapper.classList.add(e._class.block,e._class.block_position,e._class.block_theme,e._class.block_layout),e._viewportHeight=window.innerHeight||document.documentElement.clientHeight,e._wrapperDistance="bottom-left"===e.options.position||"bottom-right"===e.options.position?e._viewportHeight-e._wrapper.getBoundingClientRect().bottom:e._wrapper.getBoundingClientRect().top,e._container=document.createElement("div"),e._container.classList.add(e._class.block__notifications),"popups"===e.options.layout)e._wrapper.style.height="0px";else if("panel"===e.options.layout){const t=document.createElement("div");t.classList.add(e._class.block__header);const o=document.createElement("div");o.classList.add(e._class["block__header-inner"]);const i=document.createElement("span");i.classList.add(e._class["block__header-title"]),i.innerHTML=e.options.headerText,o.appendChild(i);const s=document.createElement("span");s.classList.add(e._class["block__header-count"]),s.textContent="0",o.appendChild(s);const n=document.createElement("div");n.classList.add(e._class["block__header-minimize"]),n.innerHTML="&equiv;",o.appendChild(n),t.appendChild(o),e._wrapper.appendChild(t),o.style.height=t.offsetHeight-1+"px",e.wrapperHeight+=o.offsetHeight,e._wrapper.style.height=e.options.hideEmpty?"0px":o.offsetHeight+"px",t.addEventListener("click",(()=>{e._wrapper.style.height=e._wrapper.classList.contains(e._class.block_open)?o.offsetHeight+"px":e.wrapperHeight+"px",e._wrapper.classList.toggle(e._class.block_open)})),e._container.style.height="calc(100% - "+o.style.height+")"}if(e._wrapper.appendChild(e._container),e.options.closer){e._closer=document.createElement("div"),e._closer.classList.add(e._class.block__closer);const t=document.createElement("span");t.classList.add(e._class["block__closer-text"]),t.innerHTML=e.options.closeText,e._closer.appendChild(t);const o=document.createElement("span");o.classList.add(e._class["block__closer-count"]),o.style.display="none",e._closer.appendChild(o),"after"===e.options.insert?e._container.appendChild(e._closer):"before"===e.options.insert&&e._container.insertBefore(e._closer,e._container.childNodes[0]),e._closer.style.visibility="hidden",e._closerHeight="popups"===e.options.layout?e._closer.offsetHeight+e.options.spacing:e._closer.offsetHeight,e._closer.style.display="none",e._closer.style.visibility="visible",e._closer.addEventListener("click",(()=>{e.closeAll()}))}e._wrapper.addEventListener("Polipop.ready",(()=>{e.options.ready.call(e)})),e._wrapper.addEventListener("mouseover",(()=>{e.options.pauseOnHover&&(e._container.querySelectorAll("."+e._class.block__notification).forEach((t=>{if(!1===t.timeLeft){let o=(new Date).getTime()-t.created.getTime();o=o>parseInt(e.options.life,10)?parseInt(e.options.life,10):o,t.timeLeft=parseInt(e.options.life,10)-o}})),e._pauseOnHover=!0)})),e._wrapper.addEventListener("mouseout",(()=>{e.options.pauseOnHover&&(e._pauseOnHover=!1)})),"inline"!==e.options.position&&window.addEventListener("resize",(()=>n.call(e))),e._id=setInterval((function(){try{_.call(e)}catch(t){throw e.destroy(),t}}),parseInt(e.options.interval,10))}}class d{constructor(e,t={}){this.options=function(e,t){let o=e;return null===e&&(o={}),[].slice.call(Object.keys(t)).forEach((e=>{o[e]=t[e]})),e}(o,t),this.queue=[],this.elements=null,this.wrapperHeight=0,this._selector=e,this._wrapper=null,this._closer=null,this._container=null,this._wrapperDistance=0,this._closerHeight=0,this._id=0,this._viewportHeight=0,this._overflow=!1,this._resizing=0,this._pauseOnHover=!1,this._pause=!1,this._disable=!1,this._class={},this._class.block=this.options.block,this._class.block_position=this.options.block+"_position_"+this.options.position,this._class.block_theme=this.options.block+"_theme_"+this.options.theme,this._class.block_layout=this.options.block+"_layout_"+this.options.layout,this._class.block_open=this.options.block+"_open",this._class.block__header=this.options.block+"__header",this._class["block__header-inner"]=this.options.block+"__header-inner",this._class["block__header-title"]=this.options.block+"__header-title",this._class["block__header-count"]=this.options.block+"__header-count",this._class["block__header-minimize"]=this.options.block+"__header-minimize",this._class.block__notifications=this.options.block+"__notifications",this._class.block__closer=this.options.block+"__closer",this._class["block__closer-text"]=this.options.block+"__closer-text",this._class["block__closer-count"]=this.options.block+"__closer-count",this._class.block__notification=this.options.block+"__notification",this._class["block__notification-title"]=this.options.block+"__notification-title",this._class["block__notification-close"]=this.options.block+"__notification-close",this._class["block__notification-content"]=this.options.block+"__notification-content",this._class.block__notification_type_=this.options.block+"__notification_type_",h.call(this),i(this._wrapper,"Polipop.ready")}getOption(e){return this.options[e]}setOption(e,t){if(["appendTo","block","position","layout","spacing","headerText","closer","interval"].includes(e))return;this.options[e]=t}add(e){if(!this._disable){if(e.add||(e.add=this.options.add),"panel"===this.options.layout){const e=this._wrapper.querySelector("."+this._class["block__header-count"]);let t=e.textContent;e.textContent=++t}this.queue.push(e),s.call(this),e.add.call(this,e)}}enable(){this._disable=!1}disable(){this._disable=!0}pause(){this._pause=!0}unpause(){this._pause=!1}closeAll(){this._container.querySelectorAll("."+this._class.block__notification).forEach((e=>{i(e,"Polipop.beforeClose")}))}emptyQueue(){this.queue=[]}destroy(){this._wrapper&&(this.elements=null,this._container=null,this._closer=null,this._wrapper.remove(),this._wrapper=null,clearInterval(this._id))}}return t=t.default})()}));